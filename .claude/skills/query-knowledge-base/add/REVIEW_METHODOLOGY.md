# 文档和脚本审查方法论

## 核心原则

**站在使用者视角**：文档和脚本是给使用者（AI/开发者）看的，必须从他们的角度审视。

---

## 审查流程

### 第一步：角色切换

**要求**：把自己当成第一次看到这个文档/脚本的使用者

**检查清单**：
- [ ] 我是否清楚知道如何使用？
- [ ] 我是否知道从哪里开始？
- [ ] 我是否知道需要什么输入？
- [ ] 我是否知道会得到什么输出？
- [ ] 我是否知道如何处理错误？

### 第二步：发现疑惑点

**常见疑惑类型**：

1. **执行上下文不明确**
   - 从哪个目录执行？
   - 路径是相对路径还是绝对路径？
   - 需要什么前置条件？

2. **使用场景不清晰**
   - 什么时候应该使用？
   - 什么情况下不应该使用？
   - 使用流程是什么？

3. **输入输出不明确**
   - 需要什么参数？
   - 参数格式是什么？
   - 返回什么格式？
   - 错误时返回什么？

4. **内容提取指南缺失**
   - 如何从上下文中提取信息？
   - 提取的规则是什么？
   - 有什么建议或限制？

5. **错误处理不完善**
   - 可能遇到什么错误？
   - 错误时如何处理？
   - 错误信息是否友好？

### 第三步：通过代码验证

**方法**：阅读相关代码文件，验证文档描述是否准确

**检查点**：
- [ ] 代码实现与文档描述是否一致？
- [ ] 代码是否有文档未提及的功能？
- [ ] 代码是否有潜在问题（错误处理、资源管理、输入验证）？

### 第四步：优化改进

**文档优化**：
- 补充缺失的说明
- 明确执行方式
- 添加使用示例
- 说明输入输出格式
- 添加常见问题

**代码优化**：
- 添加错误处理
- 统一输出格式
- 使用最佳实践（context manager、输入验证等）
- 改进错误信息

---

## 审查检查表

### 文档审查

- [ ] **执行方式**：是否明确说明如何执行（路径、命令、上下文）？
- [ ] **使用场景**：是否说明何时使用、何时不使用？
- [ ] **输入说明**：是否清楚说明需要什么参数、格式、是否必需？
- [ ] **输出说明**：是否说明成功/失败的返回格式？
- [ ] **内容提取**：是否说明如何从上下文中提取信息？
- [ ] **示例完整**：示例是否覆盖常见场景？
- [ ] **错误处理**：是否说明可能的错误和解决方法？

### 代码审查

- [ ] **错误处理**：是否有完善的异常捕获和处理？
- [ ] **输入验证**：是否验证必需参数和格式？
- [ ] **资源管理**：是否正确管理资源（连接、文件等）？
- [ ] **输出格式**：成功/失败是否统一格式？
- [ ] **错误信息**：错误信息是否清晰友好？
- [ ] **代码结构**：函数职责是否清晰、是否可复用？

---

## 实践示例

### 示例：审查 add_db.py 脚本

**第一步：角色切换**
- 我是AI，第一次看到这个脚本，需要用它存储记忆

**第二步：发现疑惑**
1. ❓ 从哪个目录执行？路径怎么写？
2. ❓ 需要什么前置条件？（后端服务、依赖库）
3. ❓ 如何提取 title、content、tags？
4. ❓ 如果出错了怎么办？返回什么格式？
5. ❓ 数据存储到哪里？是否同时存储到向量数据库？

**第三步：代码验证**
- 查看 `add_db.py` 代码
- 发现：通过 API 调用，会自动同时存储到 SQLite 和向量数据库
- 发现：需要后端服务运行，需要 requests 库
- 发现：有完善的错误处理（连接错误、超时错误等）

**第四步：优化改进**
- ✅ 添加错误处理（try-except，区分不同类型的错误）
- ✅ 统一JSON输出格式
- ✅ 通过 API 调用，确保数据一致性（同时存储到 SQLite 和向量数据库）
- ✅ 添加输入验证
- ✅ 更新文档说明执行方式、前置条件和内容提取
- ✅ 添加常见问题解答（连接错误、依赖库安装等）

---

## 关键要点

1. **换位思考**：永远站在使用者角度
2. **质疑一切**：不假设使用者知道任何信息
3. **代码验证**：用代码验证文档，用文档验证代码
4. **持续改进**：审查不是一次性的，要持续优化

---

## 适用场景

- 编写新文档时
- 编写新脚本时
- 代码重构后
- 收到使用反馈后
- 定期审查时

