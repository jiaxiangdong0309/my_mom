# AI知识记忆库 产品需求文档 (PRD)

**版本**: v1.0
**日期**: 2025-12-24
**文档状态**: 待评审

---

## 1. 产品概述

### 1.1 产品定位

一个为 AI 编辑器用户提供的**知识记忆与检索工具**，解决跨会话、跨编辑器的经验积累和复用问题。

### 1.2 核心价值

| 痛点 | 解决方案 |
|------|---------|
| AI 对话中的技术调研和 bug 修复经验无法保存 | 自动记录结构化知识 |
| 换会话/换编辑器后无法回忆历史经验 | 语义搜索快速召回 |
| 笔记工具管理成本高，检索效率低 | AI 整理 + 一键存储 |

### 1.3 目标用户

- 使用 Cursor/Claude Code 的开发者
- 经常遇到重复性技术问题的工程师
- 需要积累个人知识库但不想手动整理的开发者

---

## 2. 用户场景

### 场景 1：Bug 修复记录

```
用户在 Cursor 中解决了一个内存泄露问题
└─> 用户说："把这个解决方案记录一下"
└─> AI 整理成标准格式
└─> 存入知识库
└─> 两周后遇到类似问题
└─> 用户问："我之前怎么解决内存泄露的？"
└─> 系统返回历史方案
```

### 场景 2：技术调研沉淀

```
用户调研了几个向量数据库选型
└─> 存储调研结论和对比
└─> 一个月后新项目需要选型
└─> 搜索："之前向量数据库怎么选的？"
└─> 快速复用决策
```

### 场景 3：跨编辑器记忆

```
上午用 Cursor 解决了一个部署问题
└─> 下午用 VS Code + Claude Code
└─> 搜索："部署 502 错误怎么处理的？"
└─> 仍然能找到上午的方案
```

---

## 3. 功能需求

### 3.1 核心功能 (MVP)

#### 功能 1：知识存储

| 字段 | 说明 | 示例 |
|------|------|------|
| `title` | 简短标题 | "修复生产环境内存泄露问题" |
| `content` | 完整内容（对话/代码/思路） | "问题现象：OOM错误...\n解决思路：使用pprof分析..." |
| `tags` | 标签数组 | `["bug", "内存", "golang"]` |
| `created_at` | 创建时间 | 自动生成 |

**触发方式**: 用户明确指令（如"记录这个"、"存储这个经验"）

#### 功能 2：语义搜索

用户输入自然语言查询，系统返回最相关的 Top 3 条记录。

```
输入: "我之前怎么处理内存泄露的？"
返回:
  1. [2025-12-20] 修复生产环境内存泄露 - 相关度 0.92
  2. [2025-12-15] Golang 内存优化技巧 - 相关度 0.85
  3. [2025-12-10] pprof 使用指南 - 相关度 0.78
```

#### 功能 3：多维过滤

支持以下条件组合查询：

- 时间范围：最近 7 天 / 30 天 / 自定义
- 标签：包含某个标签
- 关键词：标题/内容全文检索

#### 功能 4：知识管理

通过 Web UI 查看、删除记录。

---

### 3.2 暂不实现 (v2.0 考虑)

- [ ] 内容编辑
- [ ] 标签管理（合并、重命名）
- [ ] 数据导出
- [ ] 自动存储（AI 判断有价值内容）
- [ ] 多用户支持
- [ ] 知识图谱/关联推荐

---

## 4. 技术架构

### 4.1 整体架构

```
┌─────────────────────────────────────────────────────┐
│                  AI 编辑器层                         │
│        (Cursor Skills / Claude Code MCP)            │
└──────────────────────┬──────────────────────────────┘
                       │ HTTP API
                       ▼
┌─────────────────────────────────────────────────────┐
│              Memory Service (单服务)                 │
│  ┌─────────────────────────────────────────────┐    │
│  │              API Layer                       │    │
│  │  POST   /api/v1/memories      (存储)        │    │
│  │  POST   /api/v1/search         (搜索)        │    │
│  │  GET    /api/v1/memories/:id   (详情)        │    │
│  │  DELETE /api/v1/memories/:id   (删除)        │    │
│  └──────────────────────┬──────────────────────┘    │
│  ┌──────────────────────▼──────────────────────┐    │
│  │           Data Access Layer                  │    │
│  │  - 向量搜索 (sqlite-vec / chroma)            │    │
│  │  - 全文搜索 (FTS5)                           │    │
│  │  - 精确查询 (SQL)                            │    │
│  └──────────────────────┬──────────────────────┘    │
│  ┌──────────────────────▼──────────────────────┐    │
│  │           Storage Layer                      │    │
│  │  ┌────────────────────────────────────┐     │    │
│  │  │  SQLite + Vector Extension         │     │    │
│  │  │  - memories 表 (结构化数据)         │     │    │
│  │  │  - memories_fts (全文索引)         │     │    │
│  │  │  - embedding 字段 (向量)            │     │    │
│  │  └────────────────────────────────────┘     │    │
│  └─────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────┐    │
│  │           Embedded Web UI                    │    │
│  │  - 记录列表 (搜索/过滤)                      │    │
│  │  - 详情查看                                  │    │
│  │  - 删除操作                                  │    │
│  └─────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────┘
```

### 4.2 技术选型建议

| 层级 | 方案 | 说明 |
|------|------|------|
| **服务** | Python Flask/FastAPI 或 Node.js Express | 简单的 HTTP 服务 |
| **数据库** | SQLite + sqlite-vec | 单文件部署，支持向量 |
| **备选** | Chroma (向量) + SQLite (结构化) | 更成熟的向量方案 |
| **前端** | 简单 HTML + Vanilla JS | 无需框架，够用即可 |
| **向量化** | OpenAI Embedding API 或 Ollama 本地模型 | 用户可配置 |

---

## 5. 数据结构设计

### 5.1 数据库表结构

```sql
-- 主表
CREATE TABLE memories (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  tags TEXT NOT NULL,  -- JSON 数组: ["bug", "内存"]
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 向量表 (使用 sqlite-vec)
CREATE TABLE memory_embeddings (
  memory_id INTEGER PRIMARY KEY REFERENCES memories(id) ON DELETE CASCADE,
  embedding BLOB NOT NULL  -- 向量数据
);

-- 全文搜索表
CREATE VIRTUAL TABLE memories_fts USING fts5(
  title,
  content,
  content=memories,
  content_rowid=id
);

-- 索引
CREATE INDEX idx_memories_created ON memories(created_at DESC);
CREATE INDEX idx_memories_tags ON memories(tags);
```

### 5.2 API 数据结构

#### 存储

```json
POST /api/v1/memories

{
  "title": "修复生产环境内存泄露",
  "content": "问题现象：服务频繁OOM\n\n排查步骤：\n1. 使用 pprof 采集堆内存\n2. 发现 goroutine 泄露\n3. 定位到未关闭的 websocket 连接\n\n解决方案：添加 defer close()",
  "tags": ["bug", "内存", "golang", "websocket"]
}

Response: 201 Created
{
  "id": 123,
  "created_at": "2025-12-24T10:30:00Z"
}
```

#### 搜索

```json
POST /api/v1/search

{
  "query": "我之前怎么解决内存泄露的？",
  "filters": {
    "tags": ["bug"],
    "days": 30
  },
  "limit": 3
}

Response: 200 OK
{
  "results": [
    {
      "id": 123,
      "title": "修复生产环境内存泄露",
      "content": "问题现象：服务频繁OOM...",
      "tags": ["bug", "内存", "golang"],
      "created_at": "2025-12-20T10:30:00Z",
      "relevance": 0.92
    },
    {
      "id": 100,
      "title": "Golang 内存优化技巧",
      "content": "使用 sync.Pool...",
      "tags": ["性能", "内存"],
      "created_at": "2025-12-15T14:20:00Z",
      "relevance": 0.85
    }
  ]
}
```

---

## 6. 交互流程

### 6.1 存储流程

```
┌─────────────────┐
│  用户在 Cursor  │
│  解决了一个问题  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 用户输入指令:   │
│ "记录这个经验"  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ AI Skill 处理:  │
│ 1. 提取标题     │
│ 2. 总结内容     │
│ 3. 生成标签     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 调用 API:       │
│ POST /memories  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 系统处理:       │
│ 1. 存储到 SQLite│
│ 2. 生成向量     │
│ 3. 返回成功     │
└─────────────────┘
```

### 6.2 搜索流程

```
┌─────────────────┐
│ 用户提问:       │
│ "之前怎么处理   │
│  内存泄露的？"  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ AI Skill 调用:  │
│ POST /search    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 系统处理:       │
│ 1. 向量化查询   │
│ 2. Top K 检索   │
│ 3. 取完整数据   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 返回结果给 AI   │
│ AI 总结后回复   │
└─────────────────┘
```

---

## 7. Web UI 设计

### 7.1 页面布局

```
┌─────────────────────────────────────────────────────┐
│  AI Memory Hub                           [设置] [?] │
├─────────────────────────────────────────────────────┤
│  搜索: [我之前怎么解决内存泄露的？         ] [搜索]  │
│  过滤: 标签: [全部▼] 时间: [全部▼]                   │
├─────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────┐  │
│  │ 📌 修复生产环境内存泄露       [2025-12-20]     │  │
│  │ 🏷️ bug · 内存 · golang                       │  │
│  │                                               │  │
│  │ 问题现象：服务频繁OOM                          │  │
│  │ 排查步骤：                                     │  │
│  │ 1. 使用 pprof 采集堆内存...                    │  │
│  │                    [查看详情] [删除]           │  │
│  └───────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────┐  │
│  │ 📌 Golang 内存优化技巧         [2025-12-15]   │  │
│  │ 🏷️ 性能 · 内存                                │  │
│  │                    [查看详情] [删除]           │  │
│  └───────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────┤
│  共 23 条记录                                         │
└─────────────────────────────────────────────────────┘
```

### 7.2 功能列表

- [ ] 搜索框（自然语言 + 关键词）
- [ ] 标签过滤器
- [ ] 时间范围过滤器
- [ ] 记录列表（卡片式）
- [ ] 详情弹窗
- [ ] 删除确认

---

## 8. MVP 范围

### v1.0 本期实现

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 数据库表结构 | P0 | memories + embeddings + FTS |
| 存储接口 | P0 | POST /api/v1/memories |
| 向量搜索接口 | P0 | POST /api/v1/search |
| 基础 Web UI | P1 | 列表 + 搜索 + 删除 |
| 标签过滤 | P1 | 按标签筛选 |
| 时间过滤 | P2 | 时间范围查询 |

### v2.0 后续规划

- [ ] 内容编辑功能
- [ ] 数据导出
- [ ] 自动存储（AI 判断）
- [ ] 知识关联推荐
- [ ] 统计面板（存储趋势、标签云）

---

## 9. 成功指标

| 指标 | 目标 |
|------|------|
| 搜索准确率 | Top 1 结果相关度 > 0.8 |
| 响应速度 | 搜索响应 < 500ms |
| 用户留存 | 存储超过 10 条记录的用户比例 > 60% |

---

## 10. 风险与限制

| 风险 | 应对 |
|------|------|
| 向量化 API 费用 | 支持本地模型 |
| SQLite 并发限制 | 单用户场景足够 |
| 数据丢失风险 | 提供备份/恢复功能 (v1.1) |
| 隐私问题 | 本地存储，不上云 |

---

## 11. 开发排期建议

| 阶段 | 任务 | 预计工作量 |
|------|------|-----------|
| **Week 1** | 数据库设计 + API 框架搭建 | 2-3 天 |
| | 向量存储 + 检索实现 | 2-3 天 |
| **Week 2** | 存储接口开发 + 测试 | 1-2 天 |
| | 搜索接口开发 + 测试 | 2-3 天 |
| | 基础 Web UI 开发 | 2-3 天 |
| **Week 3** | 集成测试 + Bug 修复 | 2-3 天 |
| | 文档编写 + 部署指南 | 1-2 天 |

---

## 12. 方案对比

### 12.1 与现有解决方案对比

| 对比维度 | Cursor Rules / Claude Code 配置 | 文件存储（Markdown + 索引） | 本方案 (AI Memory Hub) |
|---------|-------------------------------|---------------------------|----------------------|
| **实现方式** | 项目根目录下 `.cursorrules` 或 `.claude` 文件 | 每个 memory 一个 md 文件 + 总索引文件 | SQLite + 向量数据库 + API 服务 |
| **存储容量** | ❌ 不适合存储大量内容（会话上下文限制） | ✅ 无限制，文件越多管理越复杂 | ✅ 无限制，结构化存储易管理 |
| **搜索方式** | ❌ AI 读取全文后回答（慢、费 token） | ❌ grep 关键词或肉眼查找 | ✅ 语义搜索 + 关键词 + 时间/标签过滤 |
| **模糊搜索** | ⚠️ 依赖 AI 理解能力，不稳定 | ❌ 只能精确匹配关键词 | ✅ 向量语义匹配，相关度排序 |
| **跨编辑器** | ❌ 每个编辑器独立配置 | ✅ 文件通用，但需手动同步 | ✅ 统一 API，编辑器无关 |
| **数据整理** | ⚠️ 需要手动编辑整理 | ⚠️ 需要手动维护索引 | ✅ AI 自动整理 + 结构化存储 |
| **管理界面** | ❌ 纯文本编辑 | ⚠️ 文件管理器 | ✅ Web UI 可视化 |
| **技术复杂度** | ✅ 极低（写文本） | ✅ 低（文件操作） | ⚠️ 中（需运行服务） |
| **部署成本** | ✅ 无需部署 | ✅ 无需部署 | ⚠️ 本地运行一个服务 |
| **适用场景** | 项目固定的规则/规范 | 少量记忆、低频查询 | 大量记忆、高频语义搜索 |

### 12.2 选择建议

**选择 Rules / 配置文件，如果：**
- 只需要存储项目级规则和规范
- 内容相对固定，不需要频繁增删
- 不需要复杂搜索功能

**选择文件存储，如果：**
- 记忆量较少（< 50 条）
- 对技术复杂度敏感，不想运行额外服务
- 主要靠关键词精确查找

**选择本方案，如果：**
- 需要积累大量技术经验（> 100 条）
- 经常需要模糊搜索回忆历史方案
- 跨多个编辑器/项目使用同一知识库
- 希望有可视化界面管理

---

## 13. 附录

### 13.1 参考资料

- [sqlite-vec 文档](https://github.com/asg017/sqlite-vec)
- [Chroma 文档](https://docs.trychroma.com/)
- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)

### 13.2 相关工具对比

| 工具 | 适用场景 | 是否采用 |
|------|---------|---------|
| Obsidian | 个人知识管理 | ❌ 检索效率低 |
| Notion | 团队协作文档 | ❌ 过于重量级 |
| Markdown 文件 | 简单笔记 | ❌ 缺少语义搜索 |
| 本方案 | AI 对话经验管理 | ✅ |

---

**文档结束**

如有疑问或需要补充，请随时提出。
